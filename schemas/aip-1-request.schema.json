{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AIP-1: Service Request Metadata",
  "description": "Request metadata format for AGIRAILS transactions, stored on IPFS and hashed on-chain",
  "type": "object",
  "required": [
    "version",
    "serviceType",
    "requestId",
    "consumer",
    "provider",
    "chainId",
    "inputData",
    "paymentTerms",
    "timestamp"
  ],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "AIP-1 version (semantic versioning)",
      "examples": ["1.0.0"]
    },
    "serviceType": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "minLength": 1,
      "maxLength": 64,
      "description": "Service category identifier (kebab-case)",
      "examples": [
        "text-generation",
        "image-generation",
        "code-generation",
        "data-analysis",
        "web-scraping",
        "api-integration",
        "file-conversion",
        "translation",
        "sentiment-analysis",
        "custom"
      ]
    },
    "requestId": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_-]{8,128}$",
      "description": "Consumer-generated unique request identifier",
      "examples": ["req_2024_11_16_abc123xyz"]
    },
    "consumer": {
      "type": "string",
      "pattern": "^did:ethr:(\\d+:)?(0x)?[a-fA-F0-9]{40}$",
      "description": "Consumer DID (must match on-chain tx.requester)",
      "examples": ["did:ethr:84532:0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb"]
    },
    "provider": {
      "type": "string",
      "pattern": "^did:ethr:(\\d+:)?(0x)?[a-fA-F0-9]{40}$",
      "description": "Provider DID (must match on-chain tx.provider)",
      "examples": ["did:ethr:84532:0x8f4e7d2a9c1b5e3f6a8d2c4e1f7b9a3d5c8e2f6a"]
    },
    "chainId": {
      "type": "integer",
      "enum": [84532, 8453],
      "description": "Chain ID (84532 = Base Sepolia, 8453 = Base Mainnet)"
    },
    "inputData": {
      "type": "object",
      "minProperties": 1,
      "description": "Service-specific input parameters (non-empty object)",
      "examples": [
        {
          "prompt": "Summarize the latest AI research papers",
          "maxTokens": 1000,
          "temperature": 0.7
        }
      ]
    },
    "deliveryRequirements": {
      "type": "object",
      "description": "Output format and quality constraints (optional)",
      "properties": {
        "format": {
          "type": "string",
          "enum": ["json", "text", "binary", "url"],
          "default": "json",
          "description": "Expected output format"
        },
        "schema": {
          "type": "string",
          "format": "uri",
          "description": "JSON Schema URL for output validation (optional)",
          "examples": ["https://schema.agirails.io/text-generation-v1.json"]
        },
        "minQuality": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "default": 0.0,
          "description": "Minimum quality score (0.0-1.0)"
        },
        "maxLatency": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum acceptable response time in seconds (optional)"
        },
        "encryption": {
          "type": "object",
          "description": "Encryption requirements for delivery (optional)",
          "required": ["required", "algorithm", "publicKey"],
          "properties": {
            "required": {
              "type": "boolean",
              "description": "Whether encryption is mandatory"
            },
            "algorithm": {
              "type": "string",
              "enum": ["aes-256-gcm", "chacha20-poly1305"],
              "description": "Encryption algorithm"
            },
            "publicKey": {
              "type": "string",
              "pattern": "^0x[a-fA-F0-9]+$",
              "description": "Consumer's public key (hex-encoded)"
            }
          }
        }
      },
      "additionalProperties": false
    },
    "paymentTerms": {
      "type": "object",
      "required": ["amount", "currency", "decimals", "deadline", "disputeWindow"],
      "description": "Transaction payment details",
      "properties": {
        "amount": {
          "type": "string",
          "pattern": "^[0-9]+$",
          "description": "Payment amount in base units (string to avoid JS integer overflow). For USDC with 6 decimals: 1 USDC = 1,000,000 base units",
          "examples": ["5000000"]
        },
        "currency": {
          "type": "string",
          "const": "USDC",
          "description": "Payment token symbol (currently only USDC supported)"
        },
        "decimals": {
          "type": "integer",
          "const": 6,
          "description": "Token decimal places (USDC = 6)"
        },
        "maxPrice": {
          "type": "string",
          "pattern": "^[0-9]+$",
          "description": "Maximum acceptable price for quote negotiation (optional, in base units)"
        },
        "deadline": {
          "type": "integer",
          "minimum": 0,
          "description": "Transaction expiry timestamp (Unix seconds)"
        },
        "disputeWindow": {
          "type": "integer",
          "minimum": 3600,
          "maximum": 2592000,
          "description": "Dispute period in seconds (1h-30d range)"
        }
      },
      "additionalProperties": false
    },
    "metadata": {
      "type": "object",
      "description": "Custom consumer-defined fields (optional)",
      "properties": {
        "priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"],
          "description": "Request priority level"
        },
        "callbackUrl": {
          "type": "string",
          "format": "uri",
          "description": "Webhook URL for delivery notification",
          "pattern": "^https://.*"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-z0-9-]+$"
          },
          "description": "Categorization tags"
        }
      },
      "additionalProperties": true
    },
    "timestamp": {
      "type": "integer",
      "minimum": 0,
      "description": "Request creation time (Unix timestamp in seconds)"
    }
  },
  "additionalProperties": false
}
